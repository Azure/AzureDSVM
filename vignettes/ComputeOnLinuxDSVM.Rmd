---
title = "Using Azure Data Science Resources: Compute on Linux DSVM Quick Start"
author= "Graham Williams"
---

# Use Case

A common use case is for a Data Scientist to create their R programs
to analyse a dataset on their local compute platform (e.g., a laptop
with 6GB RAM running Ubuntu with R installed). Development is
performed with a subset of the full dataset (a random sample) that
will not exceed the available memory and will return results
quickly. When the experimental setup is complete the script can be
sent across to an considerably more capable compute engine on Azure.

A Linux Data Science Virtual Machine (DSVM) is deployed, the analysis
completed, results collected, and the compute resources deleted. Azure
consumption costs are minimised.

This demonstrate presents how an experimental data analytics can be thrown
onto a Linux DSVM or a customized Linux DSVM set and executed in a desired
high-performance computing context.

# Setup

We assume that the first step of [ConnectToLinuxDSVM](https://github.com/Azure/AzureDSR/vignettes/ConnectToLinuxDSVM.Rmd) has been done, and there is at least one Linux DSVM existing at the created resouce group.

To begin with, let's check the status of the DSVM and start it if it is deallocated. This is achieved with AzureSMR, and again confidentials for authenticating the app in Active Directory should be provided.
```{r credentials, eval=FALSE}
# Credentials come from app creation in Active Directory within Azure.
 
TID <- "72f9....db47"          # Tenant ID
CID <- "9c52....074a"          # Client ID
KEY <- "9Efb....4nwV....ASa8=" # User key
```

```{r packages}
# Load the required packages.

library(AzureSMR)    # Support for managing Azure resources.
library(AzureDSR)    # Further support for the Data Scientist.
library(magrittr)    
library(dplyr)
library(rattle)      # Use weatherAUS as a "large" dataset.
```

```{r tuning}
# Parameters for this script: the name for the new resource group and
# its location across the Azure cloud. The resource name is used to
# name the resource group that we will create transiently for the
# purposes of this script.

# RG  <- "my_dsvm_rg_sea"  # Create if not already exist then kill.
RG     <- "dsvm"
LOC    <- "southeastasia"   # Where the resource group (resources) will be hosted.
VM     <- "msvm001"
VM_URL <- paste(VM, LOC, "cloudapp.azure.com", sep=".")
```

# DSVM Operation

One can simply operate the created DSVM instance as desired. 
```{r dsvm operation}
# authentication.

context <- createAzureContext(tenantID=TID, clientID=CID, authKey=KEY)

# get VM list under the resource group.

vm_names <- 
  AzureSMR::azureListVM(context, RG, LOC) %T>%
  print()

# check status of a DSVM.

operateDSVM(context, RG, VM, operation="Check")

# start the DSVM if it is not running.

operateDSVM(context, RG, VM, operation="Start")

# stop the DSVM

operateDSVM(context, RG, VM, operation="Stop")
```

# Run analytics.

Next step is to use the DSVM for data analytics.

There are many ways of interacting with a DSVM. For both Linux and Windows based DSVMs, it is convenient to remote login onto the machines with GUI (more detailed information can be found [here](https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-data-science-provision-vm)). A lot of times remote execution within R session is preferred by data scientist as it can be efficiently automated by R scripts. The following chunks of codes demonstrate how to use an R interface for remote execution of R scripts under a desired computing context.  

```{r set R interface}

# create an R interface for handling the remote execution.

interface <- createRInterface(remote=VM_URL, user=USER)

# create a script for remote execution.

newScript(path=".", title="experiment1.R")

# put analytics into the script.

updateScript(interface)
```
